
1. Run the fuzzer
   [Example]: $ python3 fuzz_this.py

2. When it crashes, you should see value in input in EAX
   [Example]: EAX ASCII "GMON /./././././."

3. Right click the address (like 0194F200) and click show in dump
   (you should see the user input)

4. Open the sqlite db that boofuzz made:
   [Example]: $ sqlitebrowser run-2021-09-18T08-18-14.db

5. Go to the "Browse Data" tab

6. Click the drop down menu and switch it to steps

7. Ctrl-F and input the ascii from step 2
   [Example]: Ctrl-F -> GMON /./././././.

8. Once you have found the relevant line, look at the row above it
   and find out how many bytes were sent

   [Example]:
```                         v-----this number
427 |   36| info | Sending 10005 bytes   |
428 |   36| send |                       |  GMON ...
```

9. Follow the exploit templates
  + Make sure characters observed are input in the payload
  [Example]: payload = b"".join([
               b"GMON /.",  # note the `/.` pattern seen in step 7
               stuff
            ])

10. To verify whether `_SEH_` was overwritten in Immunity
 [Do]: Alt-S OR `View -> SEHchain`


11. Exploit

 + For nop_sled, visit HTER or TRUN

- - - - - - - - - - - - - - - - - - - - - - -

 + For SEH, visit GMON
  
  ---------------------------------------------------------------------------

  - `!mona seh` then find instruction set  where all security is `False`
    Example: pop; pop; ret;

  ---------------------------------------------------------------------------

  - Set a breakpoint at the address of chosen instruction set
   * DO THIS AFTER RESTARTING THE PROGRAM
   
   [Immunity]: Ctrl-G -> On the top left pane, then
                        put in address of instruction set to
                        jump to address
   [Immunity]: Ctrl-B -> set a breakpoint

  - If re-running exploit is successful, the bottom should say
    `Access violation when writting ... use Shift+F7/F8/F9 to pass exception`

  ---------------------------------------------------------------------------

  - Pass the exception: Shift+F9

   * You should now be at the breakpoint set earlier

  ---------------------------------------------------------------------------

  - Use F7 (Step into) OR F8 (Step over) to step through instructions
   * Watch registers the POP instructions target
   * Also watch the ESP and EIP registers

  ---------------------------------------------------------------------------

 - After RET, the top left pane should point back to my shellcode

  * should be pointing at the offset values (probably \x41)

  * note how many bytes are the offset value (\x41) because
    that's how many bytes you have to jump to desired shellcode
``` Immunity (4 \x41 bytes so I have 4 bytes to write in this example)   
019AFFC4    41      INC ECX  <-breakpoint    --
019AFFC4    41      INC ECX                    |__ 4 bytes
019AFFC4    41      INC ECX                    |   to write
019AFFC4    41      INC ECX                  --
019AFFC4    2B17
 [...]
019AFFCF    43      INC EBX    <--- TARGET ADDRESS TO JMP TO
```

  ---------------------------------------------------------------------------

  - Put `_JMP SHORT_` instruction to jump to our shellcode

   * Probably going to do a short jump
 [Instruction Example]: \x90\x90\xEB\x12 ; NOP, NOP, NOP, JMP SHORT \x23 bytes


  ---------------------------------------------------------------------------

  - Do EggHunter or other tactics

- - - - - - - - - - - - - - - - - - - - - - -

 + EggHunter
 [Immunity]: !mona egg -t <EGGHUNTER>
 * MAKE SURE THE <EGGHUNTER> DOES NOT HAVE BAD CHARACTERS!!!!!!!!!!!!

  - Generate egghunter in mona
  [Immunity Example]: !mona egg -t T00W
  * Egg is usually `T00WT00W` in this example

  - Place the EggHunter in the offset
    (may not have room for it after EIP)

  - You can prepend egghunter with `\xCC` cause that opcode is a breakpoint

  - Once egghunter is finished and the final exploit is crafted,
    remember if it's SEH i have to do `Shift+F9`

- - - - - - - - - - - - - - - - - - - - - - -

--------------------------------------------------------------------------
--------------------------------------------------------------------------
--------------------------------------------------------------------------

# Tips and Tactics

## If amount of shellcode at the end isn't long enough, but we there is space in the offset
+ We want to jump by a negative distance
+ We can use the `SHORT JMP` insturction since it's 1 byte
  [opcode]: \xEB

+ To get a negative distance we have to use 2's complement 
 - Let's say we wan't -70
 - 2â€™s complement = (<jump_distannce> ^ 0xff) + 1
   [Python Template]: hex( ( <jump_distance> ^ 0xff) + 1 )
   [Python Example]:  hex( (70 ^ 0xff) + 1 )
                        ^result: \xBA

--------------------------------------------------------------------------
--------------------------------------------------------------------------
--------------------------------------------------------------------------



[Options]: Make jump from buzz to exploit
1. Use sqlitebrowser to look at crash
  + Go to `Browse Data`
  + Change the drop down table of `Table`
   - Change to `steps`
  + Go down the list to see what fits
   - Can use the timestamp of immunity as reference

2. Manually
  + See what the input is in immunity
  + Mabye play on characters
   - if the input is "`./` x total_length"
   - maybe use sqlitebrowser to get length target
   - maybe just use `/` chracters to find offset length


